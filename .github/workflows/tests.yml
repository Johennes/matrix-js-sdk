name: Tests
on:
    pull_request: {}
    merge_group:
        types: [checks_requested]
    push:
        branches: [develop, master]
concurrency:
    group: ${{ github.workflow }}-${{ github.ref }}
    cancel-in-progress: true
env:
    ENABLE_COVERAGE: ${{ github.event_name != 'merge_group' }}
jobs:
    jest:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout code
              uses: actions/checkout@v4
            - name: "🔍 Read project version"
              id: version
              shell: bash
              run: |
                  version=$(cat package.json | jq -r .version)
                  echo "version=$version" >> $GITHUB_OUTPUT
            - name: "🩻 SonarCloud Scan"
              uses: SonarSource/sonarcloud-github-action@c25d2e7e3def96d0d1781000d3c429da22cd6252 # v2.0.2
              with:
                args: >
                  -Dsonar.projectVersion="$VERSION"
                  -Dsonar.host.url="$URL"
              env:
                  GITHUB_TOKEN: ${{ github.token }} # Needed to get PR information, if any
                  SONAR_TOKEN: FOO
                  VERSION: ${{ steps.version.outputs.version }}
                  URL: https://httpbin.org/#/Anything